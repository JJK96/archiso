#!/usr/bin/env bash

name="neo4j_$1"
create_container() {
    mkdir -p neo4j
    pushd neo4j
    mkdir -p data logs import plugins
    popd
    lima docker run \
    --name $name \
    -p 7474:7474 -p 7687:7687 \
    -d \
    -u "$(id -u):$(id -g)" \
    -v "$(pwd)/neo4j/data:/data" \
    -v "$(pwd)/neo4j/logs:/logs" \
    -v "$(pwd)/neo4j/import:/var/lib/neo4j/import" \
    -v "$(pwd)/neo4j/plugins:/plugins" \
    --env NEO4J_AUTH=neo4j/test \
    neo4j:latest
}

lima nerdctl start $name 2>/dev/null || create_container
open -a /Users/nw/Workspace/Applications/BloodHound.app
