#!/bin/bash
kak -clear
TEMPDIR="/tmp/kak-temp"
args=("$@")
# if there is standard input create a new file and open that
read -r -t 0.01 -d '' input
if [ -n "$input" ]; then
    mkdir -p $TEMPDIR
    temp=$(mktemp -p $TEMPDIR)
    echo "$input" > "$temp"
    args+=("$temp")
fi
if [ -z $KAK_SESSION ]; then
    KAK_SESSION="default"
    if ! kak -l | grep default > /dev/null 2>&1; then
        kak -s $KAK_SESSION -d
    fi
fi
if [ $KAK_CLIENT ]; then
    command="$command;x11-focus $KAK_CLIENT"
fi
if [ ${#args[@]} == 0 ]; then
   command="$command;new buffer *scratch*"
fi 
for file in "${args[@]}"; do
    command="$command;open-in-new-window $(realpath "$file")"
done
echo "eval '$command'" | kak -p $KAK_SESSION
