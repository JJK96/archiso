#!/bin/bash
pool=/mnt/btr_pool
backup=/mnt/btr_backup
for dir in root home srv mysql; do
    latest=$(find $pool/$dir/.snapshotz -maxdepth 1 | tail -n 1)
    backupped=$pool/$dir/.snapshotz/$(ls $backup/$dir | tail -n 1)
    command="btrfs send -p $backupped $latest | btrfs receive $backup/$dir"
    echo $command
    if [ "$1" != '--dry-run' ]; then
        eval $command
    fi
done
